<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rostock Mietspiegel Rechner 2024</title>
    <style>
        :root {
            --primary-color: #B07CD7;
            --secondary-color: #e6f2f8;
            --accent-color: #ff6600;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --border-color: #ddd;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
            --range-color: #27ae60;
            --positive-color: #e74c3c;
            --negative-color: #2ecc71;
            --slider-color: #B07CD7;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border-right: 1px solid var(--border-color);
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            background-color: var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .form-group-full {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: flex;
            align-items: center;
            font-weight: 600;
            flex: 1;
        }
        
        .form-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .value-display {
            width: 80px;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .value-positive {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--positive-color);
            border: 1px solid var(--positive-color);
        }
        
        .value-negative {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--negative-color);
            border: 1px solid var(--negative-color);
        }
        
        .value-neutral {
            background-color: rgba(149, 165, 166, 0.1);
            color: #666;
            border: 1px solid #bbb;
        }
        
        input, select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            min-width: 200px;
        }
        
        .autocomplete {
            position: relative;
            min-width: 200px;
        }
        
        .autocomplete-items {
            position: absolute;
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background-color: white;
        }
        
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }
        
        .autocomplete-items div:hover {
            background-color: var(--secondary-color);
        }
        
        .checkbox-group {
            margin-top: 10px;
            width: 100%;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            justify-content: space-between;
        }
        
        .checkbox-left {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 10px;
        }
        
        .modernization-group {
            margin-top: 10px;
            padding-left: 15px;
            border-left: 3px solid var(--primary-color);
        }
        
        .modernization-options {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            flex-wrap: wrap;
        }
        
        .modernization-options label {
            display: flex;
            align-items: center;
            font-weight: normal;
        }
        
        .info-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            margin-left: 5px;
            cursor: help;
            position: relative;
        }
        
        .tooltip {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: white;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #9a6bc2;
        }
        
        .result-box {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px dashed var(--border-color);
        }
        
        .result-label {
            font-weight: 500;
        }
        
        .result-value {
            font-weight: 600;
        }
        
        .range-container {
            margin: 15px 0;
            position: relative;
        }
        
        .range-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            position: relative;
        }
        
        .range-indicator {
            position: absolute;
            height: 100%;
            background-color: var(--range-color);
            border-radius: 10px;
        }
        
        .current-rent-marker {
            position: absolute;
            top: -5px;
            width: 4px;
            height: 30px;
            background-color: var(--accent-color);
            transform: translateX(-50%);
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        .range-end-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--range-color);
        }
        
        .difference {
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .difference.positive {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }
        
        .difference.negative {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--error-color);
        }
        
        .info-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 20px;
            line-height: 1.5;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            background-color: var(--light-gray);
            font-size: 0.8rem;
            color: #666;
        }
        
        /* Neue Slider-Stile */
        .slider-container {
            margin: 20px 0;
            position: relative;
        }
        
        .slider-track {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            position: relative;
            margin: 15px 0 30px;
        }
        
        .slider-thumb {
            width: 24px;
            height: 24px;
            background-color: var(--slider-color);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            position: absolute;
            width: 100%;
            top: 35px;
        }
        
        .slider-label {
            font-size: 0.9rem;
            color: #666;
            transform: translateX(-50%);
            position: absolute;
        }
        
        .slider-value-display {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .tooltip {
                width: 250px;
            }
            
            .form-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-controls {
                width: 100%;
                justify-content: space-between;
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Rostock Mietspiegel Rechner 2024</h1>
            <p class="subtitle">Der Mietspiegelrechner der MiGe (Mieter*innen Gewerkschaft Rostock)</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="form-group">
                    <label class="form-label" for="area">Wohnfläche (m²)</label>
                    <div class="form-controls">
                        <input type="number" id="area" min="20" max="150" step="1" placeholder="z.B. 75">
                        <div class="value-display value-neutral" id="baseRentDisplay">-</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="constructionYear">
                        Baujahr
                        <span class="info-icon">?
                            <span class="tooltip">
                                Maßgebend ist das Jahr der Bezugsfertigkeit. Bei später errichteten Wohnungen in Gebäuden – z.B. Dachgeschossausbau – gilt das Jahr des Ausbaus; Modernisierungsmaßnahmen beeinflussen nicht das Baujahr.
                            </span>
                        </span>
                    </label>
                    <div class="form-controls">
                        <select id="constructionYear">
                            <option value="">Bitte auswählen</option>
                            <option value="2021-2022">2021-2022</option>
                            <option value="2016-2020">2016-2020</option>
                            <option value="2010-2015">2010-2015</option>
                            <option value="1991-2009">1991-2009</option>
                            <option value="1960-1990">1960-1990</option>
                            <option value="1946-1959">1946-1959</option>
                            <option value="1919-1945">1919-1945</option>
                            <option value="bis-1918">bis 1918</option>
                        </select>
                        <div class="value-display value-neutral" id="constructionYearDisplay">-</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="streetInput">Wohnlage (Straße)</label>
                    <div class="form-controls">
                        <div class="autocomplete">
                            <input type="text" id="streetInput" placeholder="Straßennamen eingeben...">
                            <div id="autocomplete-list" class="autocomplete-items"></div>
                        </div>
                        <div class="value-display value-neutral" id="locationDisplay">-</div>
                    </div>
                </div>
                
                <div class="form-group-full">
                    <label class="form-label">Ausstattung der Wohnung</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="maisonette">
                                <label for="maisonette">
                                    Maisonette-Wohnung
                                    <span class="info-icon">?
                                        <span class="tooltip">Wohnung ist auf zwei Etagen verteilt und über eine interne Treppe verbunden</span>
                                    </span>
                                </label>
                            </div>
                            <div class="value-display value-neutral" id="maisonetteDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="towelRadiator">
                                <label for="towelRadiator">Handtuchheizkörper im Bad</label>
                            </div>
                            <div class="value-display value-neutral" id="towelRadiatorDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="floorHeating">
                                <label for="floorHeating">Fußbodenheizung im Bad</label>
                            </div>
                            <div class="value-display value-neutral" id="floorHeatingDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="showerAndBath">
                                <label for="showerAndBath">Dusche und Badewanne</label>
                            </div>
                            <div class="value-display value-neutral" id="showerAndBathDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="fittedKitchen">
                                <label for="fittedKitchen">
                                    Komplette Einbauküche
                                    <span class="info-icon">?
                                        <span class="tooltip">Herd, Spüle, Schränke und Einbaukühlschrank</span>
                                    </span>
                                </label>
                            </div>
                            <div class="value-display value-neutral" id="fittedKitchenDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="highQualityFloor">
                                <label for="highQualityFloor">
                                    Hochwertiger Fußbodenbelag
                                    <span class="info-icon">?
                                        <span class="tooltip">in mindestens der Hälfte der Räume (z.B. Parkettboden, Holzdielen, Vinyl-/Designböden)</span>
                                    </span>
                                </label>
                            </div>
                            <div class="value-display value-neutral" id="highQualityFloorDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="storageRoom">
                                <label for="storageRoom">
                                    Abstellraum in der Wohnung
                                    <span class="info-icon">?
                                        <span class="tooltip">kein Einbauschrank, mind. 1 m²</span>
                                    </span>
                                </label>
                            </div>
                            <div class="value-display value-neutral" id="storageRoomDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="elevator">
                                <label for="elevator">
                                    Aufzug
                                    <span class="info-icon">?
                                        <span class="tooltip">in Gebäuden mit bis zu 6 Geschossen</span>
                                    </span>
                                </label>
                            </div>
                            <div class="value-display value-neutral" id="elevatorDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="garden">
                                <label for="garden">
                                    Garten
                                    <span class="info-icon">?
                                        <span class="tooltip">alleinige oder gemeinschaftliche Nutzung</span>
                                    </span>
                                </label>
                            </div>
                            <div class="value-display value-neutral" id="gardenDisplay">-</div>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox-left">
                                <input type="checkbox" id="noBalcony">
                                <label for="noBalcony">Kein Balkon/Terrasse/Loggia</label>
                            </div>
                            <div class="value-display value-neutral" id="noBalconyDisplay">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group-full">
                    <label class="form-label">Modernisierungen (ab 2010)
                        <span class="info-icon">?
                            <span class="tooltip">
                                Der Zuschlag für Modernisierungen ergibt sich aus der Anzahl der Modernisierungen, die ab 2010 durchgeführt wurden. Es kann für eine Wohnung nur ein Zuschlag angewendet werden. Aus folgenden Modernisierungen ist die Anzahl zu bestimmen:<br><br>
                                • Sanitäreinrichtung (mind. Fliesen im Bad, Badewanne/Duschtasse, Waschbecken)<br>
                                • Elektroinstallation<br>
                                • Innen-/Wohnungstüren erneuert
                            </span>
                        </span>
                    </label>
                    <div class="modernization-group">
                        <p>Anzahl der durchgeführten Modernisierungen:</p>
                        <div class="slider-container">
                            <div class="slider-track" id="modernizationsTrack">
                                <div class="slider-thumb" id="modernizationsThumb"></div>
                            </div>
                            <div class="slider-labels">
                                <span class="slider-label" style="left: 0%;">0</span>
                                <span class="slider-label" style="left: 25%;">1</span>
                                <span class="slider-label" style="left: 50%;">2</span>
                                <span class="slider-label" style="left: 75%;">3</span>
                                <span class="slider-label" style="left: 100%;">4</span>
                            </div>
                            <div class="slider-value-display">
                                <div class="value-display value-neutral" id="modernizationsDisplay">+0,00 €</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group-full">
                    <label class="form-label">Energetische Maßnahmen (ab 2015)
                        <span class="info-icon">?
                            <span class="tooltip">
                                Der Zuschlag für energetische Maßnahmen ergibt sich aus der Anzahl der Maßnahmen, die ab 2015 durchgeführt wurden. Es kann für eine Wohnung nur ein Zuschlag angewendet werden. Aus folgenden Maßnahmen ist die Anzahl zu bestimmen:<br><br>
                                • Außenwand überwiegend gedämmt<br>
                                • Kellerdecke überwiegend gedämmt<br>
                                • Dach bzw. oberste Geschossdecke überwiegend gedämmt<br>
                                • Fensteraustausch (alle Fenster in der Wohnung)<br>
                                • Erneuerung der Heizungsinstallation (Wärmeerzeuger) (z.B. Heizkessel, Gastherme, Anschluss an Fernwärme)
                            </span>
                        </span>
                    </label>
                    <div class="modernization-group">
                        <p>Anzahl der durchgeführten Maßnahmen:</p>
                        <div class="slider-container">
                            <div class="slider-track" id="energyMeasuresTrack">
                                <div class="slider-thumb" id="energyMeasuresThumb"></div>
                            </div>
                            <div class="slider-labels">
                                <span class="slider-label" style="left: 0%;">0</span>
                                <span class="slider-label" style="left: 20%;">1</span>
                                <span class="slider-label" style="left: 40%;">2</span>
                                <span class="slider-label" style="left: 60%;">3</span>
                                <span class="slider-label" style="left: 80%;">4</span>
                                <span class="slider-label" style="left: 100%;">5</span>
                            </div>
                            <div class="slider-value-display">
                                <div class="value-display value-neutral" id="energyMeasuresDisplay">+0,00 €</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="currentRent">Aktuelle Nettokaltmiete (€)</label>
                    <div class="form-controls">
                        <input type="number" id="currentRent" min="0" step="0.01" placeholder="z.B. 600">
                        <div class="value-display value-neutral">-</div>
                    </div>
                </div>
                
                <button id="calculateBtn">Vergleichsmiete berechnen</button>
            </div>
            
            <div class="result-section">
                <div class="result-box">
                    <div class="result-title">Berechnungsergebnis</div>
                    
                    <div class="result-item">
                        <span class="result-label">Basismiete (€/m²):</span>
                        <span class="result-value" id="baseRentResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Summe Zu-/Abschläge (€/m²):</span>
                        <span class="result-value" id="adjustmentsResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Durchschnittliche Vergleichsmiete (€/m²):</span>
                        <span class="result-value" id="avgRentResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Untere Grenze (€/m²):</span>
                        <span class="result-value" id="lowerLimitResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Obere Grenze (€/m²):</span>
                        <span class="result-value" id="upperLimitResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Monatliche Vergleichsmiete (€):</span>
                        <span class="result-value" id="monthlyRentResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Untere Spanne (€):</span>
                        <span class="result-value" id="lowerSpanResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Obere Spanne (€):</span>
                        <span class="result-value" id="upperSpanResult">-</span>
                    </div>
                </div>
                
                <div class="result-box">
                    <div class="result-title">Vergleich mit aktueller Miete</div>
                    
                    <div class="range-container">
                        <div class="range-bar">
                            <div class="range-indicator" id="rangeIndicator"></div>
                            <div class="current-rent-marker" id="currentRentMarker"></div>
                        </div>
                        <div class="range-end-labels">
                            <span id="lowerSpanEndLabel">-</span>
                            <span id="upperSpanEndLabel">-</span>
                        </div>
                        <div class="range-labels">
                            <span id="lowerSpanLabel">-</span>
                            <span id="upperSpanLabel">-</span>
                        </div>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Aktuelle Miete (€):</span>
                        <span class="result-value" id="currentRentResult">-</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">Differenz (€):</span>
                        <span class="result-value" id="differenceResult">-</span>
                    </div>
                    
                    <div class="difference" id="differenceText">-</div>
                </div>
                
                <div class="info-text">
                    <p><strong>Hinweis:</strong> Dieser Rechner basiert auf dem qualifizierten Mietspiegel 2024 für Rostock. Die ortsübliche Vergleichsmiete ist eine Spanne, in der sich drei Viertel aller Mieten befinden. Die Berechnung dient als Orientierung und ersetzt keine professionelle Rechtsberatung.</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2024 - Rostock Mietspiegel Rechner | Basierend auf dem qualifizierten Mietspiegel 2024 der Hanse- und Universitätsstadt Rostock</p>
        </footer>
    </div>

    <script>
        // Vollständige Straßenliste mit Zuschlägen aus dem Mietspiegel
        const streets = [
            { name: "St.-Jürgen-Str.", adjustment: 0.81 },
            { name: "A.-Tischbein-Str.", adjustment: -0.91 },
            { name: "Aalstecherstr.", adjustment: 0.50 },
            // ... (der Rest der Straßenliste bleibt unverändert)
        ];

        // Basismiete-Tabelle (Wohnfläche in m² -> €/m²)
        const baseRentTable = {
            20: 7.68, 21: 7.63, 22: 7.59, 23: 7.54, 24: 7.50, 25: 7.45,
            // ... (der Rest der Basismietentabelle bleibt unverändert)
        };

        // Baujahr-Zuschläge
        const constructionYearAdjustments = {
            "bis-1918": 0.63,
            "1919-1945": 0.53,
            "1946-1959": 0.31,
            "1960-1990": 0.00,
            "1991-2009": 0.96,
            "2010-2015": 1.69,
            "2016-2020": 2.64,
            "2021-2022": 3.82
        };

        // Ausstattungs-Zuschläge
        const equipmentAdjustments = {
            "maisonette": 0.31,
            "towelRadiator": 0.13,
            "floorHeating": 0.71,
            "showerAndBath": 0.17,
            "fittedKitchen": 0.51,
            "highQualityFloor": 0.13,
            "storageRoom": 0.13,
            "elevator": 0.38,
            "garden": 0.31,
            "noBalcony": -0.18
        };

        // Modernisierungs-Zuschläge
        const modernizationAdjustments = {
            0: 0.00,
            1: 0.07,
            2: 0.14,
            3: 0.21,
            4: 0.28
        };

        // Energetische Maßnahmen-Zuschläge
        const energyMeasuresAdjustments = {
            0: 0.00,
            1: 0.14,
            2: 0.28,
            3: 0.42,
            4: 0.56,
            5: 0.70
        };

        // Spannenwerte
        const spanLower = -0.83;
        const spanUpper = 0.76;

        // Autovervollständigung für Straßennamen
        const streetInput = document.getElementById('streetInput');
        const autocompleteList = document.getElementById('autocomplete-list');
        let selectedStreet = null;

        streetInput.addEventListener('input', function() {
            const input = this.value;
            autocompleteList.innerHTML = '';
            
            if (input.length < 2) {
                return;
            }
            
            const filteredStreets = streets.filter(street => 
                street.name.toLowerCase().includes(input.toLowerCase())
            );
            
            filteredStreets.forEach(street => {
                const item = document.createElement('div');
                item.innerHTML = `${street.name}`;
                item.addEventListener('click', function() {
                    streetInput.value = street.name;
                    selectedStreet = street;
                    autocompleteList.innerHTML = '';
                    updateLocationDisplay();
                });
                autocompleteList.appendChild(item);
            });
        });

        // Schließe die Autovervollständigung, wenn außerhalb geklickt wird
        document.addEventListener('click', function(e) {
            if (e.target !== streetInput) {
                autocompleteList.innerHTML = '';
            }
        });

        // Event-Listener für Eingabefelder
        document.getElementById('area').addEventListener('input', updateBaseRentDisplay);
        document.getElementById('constructionYear').addEventListener('change', updateConstructionYearDisplay);
        
        // Event-Listener für Ausstattungs-Checkboxen
        const equipmentCheckboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        equipmentCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateEquipmentDisplay(this.id);
            });
        });
        
        // Slider für Modernisierungen
        const modernizationsTrack = document.getElementById('modernizationsTrack');
        const modernizationsThumb = document.getElementById('modernizationsThumb');
        let modernizationsValue = 0;
        
        // Slider für energetische Maßnahmen
        const energyMeasuresTrack = document.getElementById('energyMeasuresTrack');
        const energyMeasuresThumb = document.getElementById('energyMeasuresThumb');
        let energyMeasuresValue = 0;
        
        // Initialisiere Slider-Positionen
        modernizationsThumb.style.left = '0%';
        energyMeasuresThumb.style.left = '0%';
        
        // Funktionen für Slider-Interaktion
        function setupSlider(track, thumb, maxValue, updateFunction) {
            let isDragging = false;
            
            thumb.addEventListener('mousedown', function(e) {
                isDragging = true;
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
                e.preventDefault();
            });
            
            track.addEventListener('click', function(e) {
                if (!isDragging) {
                    const rect = track.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const percentage = Math.max(0, Math.min(1, x / rect.width));
                    const value = Math.round(percentage * maxValue);
                    updateSliderPosition(thumb, value, maxValue);
                    updateFunction(value);
                }
            });
            
            function onMouseMove(e) {
                if (isDragging) {
                    const rect = track.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const percentage = Math.max(0, Math.min(1, x / rect.width));
                    const value = Math.round(percentage * maxValue);
                    updateSliderPosition(thumb, value, maxValue);
                    updateFunction(value);
                }
            }
            
            function onMouseUp() {
                isDragging = false;
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }
        }
        
        function updateSliderPosition(thumb, value, maxValue) {
            const percentage = (value / maxValue) * 100;
            thumb.style.left = percentage + '%';
        }
        
        function updateModernizationsSlider(value) {
            modernizationsValue = value;
            updateModernizationsDisplay();
        }
        
        function updateEnergyMeasuresSlider(value) {
            energyMeasuresValue = value;
            updateEnergyMeasuresDisplay();
        }
        
        // Initialisiere Slider
        setupSlider(modernizationsTrack, modernizationsThumb, 4, updateModernizationsSlider);
        setupSlider(energyMeasuresTrack, energyMeasuresThumb, 5, updateEnergyMeasuresSlider);
        
        document.getElementById('calculateBtn').addEventListener('click', calculateRent);

        // Funktionen zur Aktualisierung der Anzeigen
        function updateBaseRentDisplay() {
            const area = parseInt(document.getElementById('area').value);
            const displayElement = document.getElementById('baseRentDisplay');
            
            if (area && area >= 20 && area <= 150) {
                const baseRent = baseRentTable[area];
                displayElement.textContent = baseRent.toFixed(2) + ' €';
                displayElement.className = 'value-display value-neutral';
            } else {
                displayElement.textContent = '-';
                displayElement.className = 'value-display value-neutral';
            }
        }
        
        function updateConstructionYearDisplay() {
            const constructionYear = document.getElementById('constructionYear').value;
            const displayElement = document.getElementById('constructionYearDisplay');
            
            if (constructionYear) {
                const adjustment = constructionYearAdjustments[constructionYear];
                const adjustmentSign = adjustment > 0 ? '+' : '';
                displayElement.textContent = adjustmentSign + adjustment.toFixed(2) + ' €';
                displayElement.className = adjustment > 0 ? 'value-display value-positive' : 
                                          (adjustment < 0 ? 'value-display value-negative' : 'value-display value-neutral');
            } else {
                displayElement.textContent = '-';
                displayElement.className = 'value-display value-neutral';
            }
        }
        
        function updateLocationDisplay() {
            const displayElement = document.getElementById('locationDisplay');
            
            if (selectedStreet) {
                const adjustment = selectedStreet.adjustment;
                const adjustmentSign = adjustment > 0 ? '+' : '';
                displayElement.textContent = adjustmentSign + adjustment.toFixed(2) + ' €';
                displayElement.className = adjustment > 0 ? 'value-display value-positive' : 
                                          (adjustment < 0 ? 'value-display value-negative' : 'value-display value-neutral');
            } else {
                displayElement.textContent = '-';
                displayElement.className = 'value-display value-neutral';
            }
        }
        
        function updateEquipmentDisplay(checkboxId) {
            const checkbox = document.getElementById(checkboxId);
            const displayElement = document.getElementById(checkboxId + 'Display');
            const adjustment = equipmentAdjustments[checkboxId];
            
            if (checkbox.checked) {
                const adjustmentSign = adjustment > 0 ? '+' : '';
                displayElement.textContent = adjustmentSign + adjustment.toFixed(2) + ' €';
                displayElement.className = adjustment > 0 ? 'value-display value-positive' : 
                                          (adjustment < 0 ? 'value-display value-negative' : 'value-display value-neutral');
            } else {
                displayElement.textContent = '-';
                displayElement.className = 'value-display value-neutral';
            }
        }
        
        function updateModernizationsDisplay() {
            const displayElement = document.getElementById('modernizationsDisplay');
            const adjustment = modernizationAdjustments[modernizationsValue];
            
            if (modernizationsValue > 0) {
                displayElement.textContent = '+' + adjustment.toFixed(2) + ' €';
                displayElement.className = 'value-display value-positive';
            } else {
                displayElement.textContent = '+0,00 €';
                displayElement.className = 'value-display value-neutral';
            }
        }
        
        function updateEnergyMeasuresDisplay() {
            const displayElement = document.getElementById('energyMeasuresDisplay');
            const adjustment = energyMeasuresAdjustments[energyMeasuresValue];
            
            if (energyMeasuresValue > 0) {
                displayElement.textContent = '+' + adjustment.toFixed(2) + ' €';
                displayElement.className = 'value-display value-positive';
            } else {
                displayElement.textContent = '+0,00 €';
                displayElement.className = 'value-display value-neutral';
            }
        }

        // Hauptberechnungsfunktion
        function calculateRent() {
            // Eingaben auslesen
            const area = parseInt(document.getElementById('area').value);
            const constructionYear = document.getElementById('constructionYear').value;
            const currentRent = parseFloat(document.getElementById('currentRent').value) || 0;
            
            // Straßenzuschlag ermitteln
            let locationAdjustment = 0;
            if (selectedStreet) {
                locationAdjustment = selectedStreet.adjustment;
            } else if (streetInput.value) {
                // Versuche, den Straßennamen in der Liste zu finden
                const foundStreet = streets.find(street => 
                    street.name.toLowerCase() === streetInput.value.toLowerCase()
                );
                if (foundStreet) {
                    locationAdjustment = foundStreet.adjustment;
                    selectedStreet = foundStreet;
                    updateLocationDisplay();
                }
            }
            
            // Validierung
            if (!area || area < 20 || area > 150) {
                alert('Bitte geben Sie eine gültige Wohnfläche zwischen 20 und 150 m² ein.');
                return;
            }
            
            if (!constructionYear) {
                alert('Bitte wählen Sie das Baujahr aus.');
                return;
            }
            
            // Basismiete berechnen
            const baseRent = baseRentTable[area];
            
            // Zu- und Abschläge berechnen
            let adjustments = 0;
            
            // Baujahr-Zuschlag
            adjustments += constructionYearAdjustments[constructionYear] || 0;
            
            // Wohnlage-Zuschlag
            adjustments += locationAdjustment;
            
            // Ausstattungs-Zuschläge
            for (const [key, value] of Object.entries(equipmentAdjustments)) {
                if (document.getElementById(key).checked) {
                    adjustments += value;
                }
            }
            
            // Modernisierungs-Zuschlag
            adjustments += modernizationAdjustments[modernizationsValue] || 0;
            
            // Energetische Maßnahmen-Zuschlag
            adjustments += energyMeasuresAdjustments[energyMeasuresValue] || 0;
            
            // Durchschnittliche Vergleichsmiete pro m²
            const avgRentPerSqm = baseRent + adjustments;
            
            // Spannenwerte pro m²
            const lowerLimitPerSqm = avgRentPerSqm + spanLower;
            const upperLimitPerSqm = avgRentPerSqm + spanUpper;
            
            // Monatliche Vergleichsmiete
            const monthlyRent = avgRentPerSqm * area;
            const lowerSpan = lowerLimitPerSqm * area;
            const upperSpan = upperLimitPerSqm * area;
            
            // Ergebnisse anzeigen
            document.getElementById('baseRentResult').textContent = baseRent.toFixed(2) + ' €';
            document.getElementById('adjustmentsResult').textContent = adjustments.toFixed(2) + ' €';
            document.getElementById('avgRentResult').textContent = avgRentPerSqm.toFixed(2) + ' €';
            document.getElementById('lowerLimitResult').textContent = lowerLimitPerSqm.toFixed(2) + ' €';
            document.getElementById('upperLimitResult').textContent = upperLimitPerSqm.toFixed(2) + ' €';
            document.getElementById('monthlyRentResult').textContent = monthlyRent.toFixed(2) + ' €';
            document.getElementById('lowerSpanResult').textContent = lowerSpan.toFixed(2) + ' €';
            document.getElementById('upperSpanResult').textContent = upperSpan.toFixed(2) + ' €';
            document.getElementById('currentRentResult').textContent = currentRent.toFixed(2) + ' €';
            
            // Differenz berechnen und anzeigen
            const difference = currentRent - monthlyRent;
            document.getElementById('differenceResult').textContent = difference.toFixed(2) + ' €';
            
            const differenceText = document.getElementById('differenceText');
            if (difference > 0) {
                differenceText.textContent = `Ihre Miete liegt ${difference.toFixed(2)} € über der durchschnittlichen Vergleichsmiete`;
                differenceText.className = 'difference negative';
            } else if (difference < 0) {
                differenceText.textContent = `Ihre Miete liegt ${Math.abs(difference).toFixed(2)} € unter der durchschnittlichen Vergleichsmiete`;
                differenceText.className = 'difference positive';
            } else {
                differenceText.textContent = 'Ihre Miete entspricht der durchschnittlichen Vergleichsmiete';
                differenceText.className = 'difference';
            }
            
            // Spanne-Balken aktualisieren
            updateRangeBar(lowerSpan, upperSpan, currentRent);
            
            // Spannen-Labels aktualisieren
            document.getElementById('lowerSpanLabel').textContent = lowerSpan.toFixed(0) + ' €';
            document.getElementById('upperSpanLabel').textContent = upperSpan.toFixed(0) + ' €';
            document.getElementById('lowerSpanEndLabel').textContent = lowerSpan.toFixed(0) + ' €';
            document.getElementById('upperSpanEndLabel').textContent = upperSpan.toFixed(0) + ' €';
        }
        
        function updateRangeBar(lowerSpan, upperSpan, currentRent) {
            const rangeBar = document.getElementById('rangeIndicator');
            const currentRentMarker = document.getElementById('currentRentMarker');
            const rangeBarWidth = document.querySelector('.range-bar').offsetWidth;
            
            // Bereich für die Spanne definieren (mit etwas Puffer)
            const minValue = Math.min(lowerSpan, currentRent) * 0.9;
            const maxValue = Math.max(upperSpan, currentRent) * 1.1;
            const valueRange = maxValue - minValue;
            
            // Position der Spanne berechnen
            const lowerPosition = ((lowerSpan - minValue) / valueRange) * 100;
            const upperPosition = ((upperSpan - minValue) / valueRange) * 100;
            const currentPosition = ((currentRent - minValue) / valueRange) * 100;
            
            // Balken und Marker positionieren
            rangeBar.style.left = lowerPosition + '%';
            rangeBar.style.width = (upperPosition - lowerPosition) + '%';
            
            currentRentMarker.style.left = currentPosition + '%';
            
            // Marker-Sichtbarkeit anpassen
            if (currentRent > 0) {
                currentRentMarker.style.display = 'block';
            } else {
                currentRentMarker.style.display = 'none';
            }
        }

        // Initiale Anzeigen aktualisieren
        updateBaseRentDisplay();
        updateConstructionYearDisplay();
        updateLocationDisplay();
        updateModernizationsDisplay();
        updateEnergyMeasuresDisplay();
    </script>
</body>
</html>